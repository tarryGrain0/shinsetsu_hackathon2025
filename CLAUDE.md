# CLAUDE.md

このファイルはClaude Code (claude.ai/code) がこのリポジトリで作業する際のガイダンスを提供します。

## プロジェクト概要

Three.js 3Dルームエクスプローラー - Three.jsを使用したブラウザベースの3D空間探索アプリケーション。ユーザーは赤い球体のアバターを操作して、GLB形式のルーム内を重力、ジャンプ、衝突判定を含む物理シミュレーションとともにナビゲートできます。

## 開発コマンド

```bash
# 開発サーバーの起動（Pythonの HTTPサーバーをポート8080で起動）
python3 -m http.server 8080
```

アクセス先: http://localhost:8080

**重要**: HTTPサーバー経由でアクセスする必要があります - ES6モジュールのCORS制限により、ファイルを直接開く（`file://`）では動作しません。

## 開発ツール

### 利用可能なMCPサーバー
- **serena MCP** - コード解析とシンボル操作のための高度なツール
  - シンボル解析（関数、クラス、変数の検索と操作）
  - 正規表現ベースのコード置換
  - プロジェクトメモリ管理
  - ファイルとディレクトリの探索

## アーキテクチャ

### 技術スタック
- **純粋なHTML/JavaScript/CSS** - ビルドプロセス不要
- **Three.js v0.160.0** - CDN (esm.sh) 経由でロード
- **npm依存関係なし** - すべてのライブラリはCDNからロード

### コア実装

アプリケーションは分離されたHTML/CSS/JSファイルで構成されています：

#### index.html
- アプリケーションのエントリーポイント
- UIコントロール表示
- 外部CSS/JSファイルの読み込み

#### main.js
メインのアプリケーションロジック：

1. **レンダリングパイプライン**:
   - アンチエイリアシングとシャドウマッピング付きWebGLRenderer
   - デバイス性能に基づく適応的ピクセル比
   - リアルな影のためのPCFソフトシャドウマッピング

2. **カメラシステム**:
   - 球面座標を使用した三人称カメラ
   - マウスドラッグで回転、ホイールでズーム
   - 衝突判定によりカメラが壁を貫通しないよう制御

3. **物理システム**:
   - カスタム重力とジャンプメカニクス
   - Raycasterベースの地面と壁の衝突判定
   - 摩擦を含む速度ベースの移動

4. **3Dモデルローディング**:
   - GLB/GLTFファイル用のGLTFLoader
   - 圧縮ジオメトリ用のDRACOLoader
   - 効率的なテクスチャ用のKTX2Loader
   - ロードされたメッシュへの自動シャドウ設定

#### main.css
- UIコントロールのスタイリング
- FPS表示とステータス表示のスタイル
- レスポンシブデザイン対応

## デプロイ

### GitHub Pages
- **mainブランチへのプッシュ時に自動デプロイ** （GitHub Actions経由）
- **ワークフロー**: `.github/workflows/deploy.yml`
- **公開URL**: https://tarryGrain0.github.io/shinsetsu_hackathon2025/

GitHub Actionsタブから手動デプロイトリガーも利用可能。

## 主要ファイル

- `index.html` - アプリケーションエントリーポイント
- `main.js` - Three.jsメインロジック（レンダリング、物理演算、操作）
- `main.css` - UIとレイアウトのスタイル
- `assets/room_sample.glb` - 3Dルームモデル
- `.gitignore` - Git除外設定
- `CLAUDE.md` - 開発ガイドライン（このファイル）

## カスタマイズポイント

### 移動パラメータ (main.js)
- `WALK = 3.0` - 歩行速度 (m/s)
- `RUN = 5.6` - ダッシュ速度 (m/s)  
- `GRAVITY = 18.0` - 重力加速度
- `JUMP_V = 8.0` - ジャンプ初速
- `camDist = 7.0` - 初期カメラ距離

### 3Dモデル
`assets/room_sample.glb`を任意のGLB/GLTFファイルに置き換えることで環境を変更できます。