# 設定モーダル設計書

## 概要
Three.js 3Dルームエクスプローラーにおいて、ユーザーが端末ごとに最適なグラフィック設定とUI表示設定を行えるようにするための設定モーダルの設計書です。

## 設定項目

### 1. グラフィック設定

#### 1.1 レンダリング品質
- **項目名**: レンダリング品質
- **タイプ**: セレクトボックス
- **選択肢**:
  - 低品質（パフォーマンス優先）
  - 中品質（バランス）
  - 高品質（品質優先）
- **デフォルト**: 中品質
- **説明**: 端末の性能に応じてレンダリング品質を調整

#### 1.2 シャドウ設定
- **項目名**: 影の表示
- **タイプ**: チェックボックス
- **デフォルト**: ON
- **説明**: 影の描画のON/OFF（パフォーマンス改善用）

#### 1.3 アンチエイリアシング
- **項目名**: アンチエイリアシング
- **タイプ**: チェックボックス
- **デフォルト**: ON
- **説明**: エッジの滑らかさの設定

#### 1.4 視野角（FOV）
- **項目名**: 視野角
- **タイプ**: スライダー
- **範囲**: 45～90度
- **デフォルト**: 75度
- **説明**: カメラの視野の広さを調整

### 2. UI/表示設定

#### 2.1 FPS表示
- **項目名**: FPS表示
- **タイプ**: チェックボックス
- **デフォルト**: ON
- **説明**: 画面右上のFPS表示のON/OFF

#### 2.2 操作ガイド表示
- **項目名**: 操作ガイド表示
- **タイプ**: チェックボックス
- **デフォルト**: ON
- **説明**: 画面左上の操作説明の表示/非表示

#### 2.3 デバッグヘルパー
- **項目名**: デバッグヘルパー表示
- **タイプ**: チェックボックス
- **デフォルト**: ON
- **説明**: 座標軸やバウンディングボックスの表示

#### 2.4 ステータス表示
- **項目名**: ステータス表示
- **タイプ**: チェックボックス
- **デフォルト**: ON
- **説明**: 画面左下のロード状態等の表示/非表示

## モーダルUI設計

### レイアウト
```
┌─────────────────────────────────────┐
│  ⚙️ 設定              [✕]           │
├─────────────────────────────────────┤
│ [グラフィック] [UI/表示]             │
├─────────────────────────────────────┤
│                                     │
│  （選択されたタブの設定項目）         │
│                                     │
│                                     │
├─────────────────────────────────────┤
│ [デフォルトに戻す]  [閉じる]         │
└─────────────────────────────────────┘
```

### デザイン仕様
- **背景**: 半透明黒（rgba(0, 0, 0, 0.8)）
- **モーダル**: 角丸、ブラー効果付き
- **幅**: 500px（モバイルでは90%）
- **高さ**: 最大600px（スクロール可能）
- **位置**: 画面中央

### インタラクション
1. **開き方**: 
   - 設定ボタン（歯車アイコン）をクリック
   - キーボードショートカット（Gキー）

2. **タブ切り替え**:
   - クリックで即座に切り替え
   - スムーズなアニメーション付き

3. **値の変更**:
   - スライダー: リアルタイム反映（ドラッグ中も更新）
   - チェックボックス: クリックで即座に反映
   - セレクトボックス: 選択時に即反映

4. **保存**:
   - 変更は即座にLocalStorageに自動保存
   - 次回起動時に自動復元
   - デフォルトに戻すボタンで初期値に戻せる

## 実装方針

### データ管理
```javascript
// 設定データ構造
const settings = {
  graphics: {
    quality: 'medium',      // 'low' | 'medium' | 'high'
    shadows: true,
    antialiasing: true,
    fov: 75
  },
  ui: {
    showFPS: true,
    showControls: true,
    showHelpers: true,
    showStatus: true
  }
};
```

### LocalStorage キー
- キー名: `three-room-explorer-settings`
- 形式: JSON文字列

### イベント処理
- 設定変更時: `settingsChanged` カスタムイベントを発火
- リアルタイム更新: requestAnimationFrame内で設定値を参照

## アクセシビリティ考慮事項
1. **キーボード操作**: Tab/Shift+Tabでのナビゲーション
2. **ARIA属性**: 適切なrole, aria-label設定
3. **フォーカス管理**: モーダル開閉時のフォーカストラップ
4. **高コントラスト**: 視認性の高い配色

## パフォーマンス最適化

### グラフィック品質による最適化
**低品質設定時**:
- pixelRatio: 1.0固定
- シャドウマップ: 512x512
- アンチエイリアシング: 強制OFF

**中品質設定時**:
- pixelRatio: Math.min(window.devicePixelRatio, 2)
- シャドウマップ: 1024x1024
- アンチエイリアシング: ユーザー設定に従う

**高品質設定時**:
- pixelRatio: window.devicePixelRatio
- シャドウマップ: 2048x2048
- アンチエイリアシング: ユーザー設定に従う

### リアルタイム更新の最適化
- スライダー操作: requestAnimationFrameで間引き
- チェックボックス: 即座に反映（パフォーマンス影響小）
- 品質変更: レンダラー再作成を最小限に

## 実装例

### 設定ボタンHTML
```html
<button id="settingsBtn" class="settings-button">
  ⚙️
</button>
```

### モーダルHTML構造
```html
<div id="settingsModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>⚙️ 設定</h2>
      <button class="close-btn">✕</button>
    </div>
    <div class="modal-tabs">
      <button class="tab active" data-tab="graphics">グラフィック</button>
      <button class="tab" data-tab="ui">UI/表示</button>
    </div>
    <div class="modal-body">
      <!-- タブコンテンツ -->
    </div>
    <div class="modal-footer">
      <button class="reset-btn">デフォルトに戻す</button>
      <button class="close-btn">閉じる</button>
    </div>
  </div>
</div>
```

## 実装優先度
1. **必須**: 基本的な設定モーダルの実装
2. **推奨**: グラフィック品質設定、LocalStorage保存
3. **オプション**: アニメーション、プリセット機能